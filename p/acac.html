<!DOCTYPE html><html lang=zh-CN><head hexo-theme=https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1><meta charset=utf-8><meta http-equiv=x-dns-prefetch-control content=on><link rel=dns-prefetch href=https://cdn.jsdelivr.net><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><meta name=renderer content=webkit><meta name=force-rendering content=webkit><meta http-equiv=X-UA-Compatible content="IE=Edge,chrome=1"><meta name=HandheldFriendly content=True><meta name=apple-mobile-web-app-capable content=yes><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1"><link rel=preload href=/css/first.css as=style><title>外卖套餐搭配的探索和应用 - Hajeekn RSSHUB</title><link rel=alternate href=/atom.xml title="Hajeekn RSSHUB" type=application/atom+xml><meta name=referrer content=no-referrer><link rel=stylesheet href=/css/diy.css><link rel=stylesheet href=/css/first.css><link rel=stylesheet href=/css/style.css media=print onload="this.media='all';this.onload=null"><noscript><link rel=stylesheet href=/css/style.css></noscript><script id=loadcss></script><script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        '<h1><b>抱歉，您的浏览器无法访问本站</b></h1>'+
        '<h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>'+
        '继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/>'+
        '<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a>'+
    '</div>');
</script><noscript><style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
	</style><div class=kill-noscript><h1><b>抱歉，您的浏览器无法访问本站</b></h1><h3>本页面需要浏览器支持（启用）JavaScript</h3><br><a target=_blank rel=noopener href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a></div></noscript></head><body><header id=l_header class="l_header always shadow blur show"><div class=container><div id=wrapper><div class=nav-sub><p class=title></p><ul class="switcher nav-list-h m-phone" id=pjax-header-nav-list><li><a id=s-comment class="fas fa-comments fa-fw" target=_self href=javascript:void(0)></a></li><li><a id=s-toc class="s-toc fas fa-list fa-fw" target=_self href=javascript:void(0)></a></li></ul></div><div class=nav-main><a class="title flat-box" target=_self href="/"><img no-lazy class=logo src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png></a><div class="menu navigation"><ul class="nav-list-h m-pc"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id=home><i class="fas fa-home fa-fw fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%8D%9A%E5%AE%A2/" id=categoriesE58D9AE5AEA2><i class="fas fa-rss fa-fw"></i> 博客订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/" id=categoriesE696B0E5AA92E4BD93><i class="fas fa-podcast fa-fw fa-fw"></i> 新媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E4%BA%8C%E6%AC%A1%E5%85%83/" id=categoriesE4BA8CE6ACA1E58583><i class="fas fa-heart fa-fw fa-fw"></i> 二次元</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%B8%B8%E6%88%8F/" id=categoriesE6B8B8E6888F><i class="fa fa-gamepad fa-fw fa-fw"></i> 游戏</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%9B%BE%E7%89%87/" id=categoriesE59BBEE78987><i class="fas fa-puzzle-piece fa-fw fa-fw"></i> 图片</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E8%AE%BE%E8%AE%A1/" id=categoriesE8AEBEE8AEA1><i class="fas fa-magic fa-fw fa-fw"></i> 设计</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%BC%96%E7%A8%8B/" id=categoriesE7BC96E7A88B><i class="fas fa-code fa-fw fa-fw"></i> 编程</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%87%91%E8%9E%8D/" id=categoriesE98791E89E8D><i class="fas fa-key fa-fw fa-fw"></i> 金融</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93/" id=categoriesE7A4BEE4BAA4E5AA92E4BD93><i class="fas fa-users fa-fw fa-fw"></i> 社交媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%98%85%E8%AF%BB/" id=categoriesE99885E8AFBB><i class="fas fa-book fa-fw fa-fw"></i> 阅读</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0/" id=categoriesE5ADA6E4B9A0><i class="fas fa-graduation-cap fa-fw fa-fw"></i> 学习</a></li></ul></div><div class=m_search><form name=searchform class="form u-search-form"><i class="icon fas fa-search fa-fw"></i> <input type=text class="input u-search-input" placeholder=Search...></form></div><ul class="switcher nav-list-h m-phone"><li><a class="s-search fas fa-search fa-fw" target=_self href=javascript:void(0)></a></li><li><a class="s-menu fas fa-bars fa-fw" target=_self href=javascript:void(0)></a><ul class="menu-phone list-v navigation white-box"><li><a class="menuitem flat-box faa-parent animated-hover" href="/" id=home><i class="fas fa-home fa-fw fa-fw"></i> 主页</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%8D%9A%E5%AE%A2/" id=categoriesE58D9AE5AEA2><i class="fas fa-rss fa-fw"></i> 博客订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%96%B0%E5%AA%92%E4%BD%93/" id=categoriesE696B0E5AA92E4BD93><i class="fas fa-podcast fa-fw fa-fw"></i> 新媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E4%BA%8C%E6%AC%A1%E5%85%83/" id=categoriesE4BA8CE6ACA1E58583><i class="fas fa-heart fa-fw fa-fw"></i> 二次元</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E6%B8%B8%E6%88%8F/" id=categoriesE6B8B8E6888F><i class="fa fa-gamepad fa-fw fa-fw"></i> 游戏</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%9B%BE%E7%89%87/" id=categoriesE59BBEE78987><i class="fas fa-puzzle-piece fa-fw fa-fw"></i> 图片</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E8%AE%BE%E8%AE%A1/" id=categoriesE8AEBEE8AEA1><i class="fas fa-magic fa-fw fa-fw"></i> 设计</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%BC%96%E7%A8%8B/" id=categoriesE7BC96E7A88B><i class="fas fa-code fa-fw fa-fw"></i> 编程</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%87%91%E8%9E%8D/" id=categoriesE98791E89E8D><i class="fas fa-key fa-fw fa-fw"></i> 金融</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93/" id=categoriesE7A4BEE4BAA4E5AA92E4BD93><i class="fas fa-users fa-fw fa-fw"></i> 社交媒体</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E9%98%85%E8%AF%BB/" id=categoriesE99885E8AFBB><i class="fas fa-book fa-fw fa-fw"></i> 阅读</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0/" id=categoriesE5ADA6E4B9A0><i class="fas fa-graduation-cap fa-fw fa-fw"></i> 学习</a></li></ul></li></ul></div></div></div></header><div id=l_body><div id=l_cover><div id=full class="cover-wrapper post dock" style="display: none;"><div class="cover-bg lazyload placeholder" data-bg="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture"></div><div class=cover-body><div class=top><p class=title>Volantis</p></div><div class=bottom><div class="menu navigation"><div class=list-h><a href="/v4/getting-started/" id=v4getting-started><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg><p>文档</p></a> <a href="/faqs/" id=faqs><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg><p>帮助</p></a> <a href="/examples/" id=examples><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f396.svg><p>示例</p></a> <a href="/contributors/" id=contributors><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f389.svg><p>社区</p></a> <a href="/archives/" id=archives><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg><p>博客</p></a> <a target=_blank rel=noopener href="https://github.com/volantis-x/hexo-theme-volantis/" id=https:githubcomvolantis-xhexo-theme-volantis><img src=https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg><p>源码</p></a></div></div></div></div><div id=scroll-down style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div></div></div><div id=safearea><div class=body-wrapper id=pjax-container><div class=l_main><article class="article post white-box reveal md shadow article-type-post" id=post itemscope itemprop=blogPost><div class=headimg-div><a class=headimg-a><img class=headimg src=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png></a></div><div class=article-meta id=top><a title=外卖套餐搭配的探索和应用 href=/p/acac.html><img class=thumbnail src=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png></a><h1 class=title>外卖套餐搭配的探索和应用</h1><div class=new-meta-box><div class="new-meta-item author"><a class=author target=_blank href="https://docs.rsshub.app/" rel="nofollow noopener"><img no-lazy src=https://i.loli.net/2019/04/23/5cbeb7e41414c.png><p>RSSHub</p></a></div><div class="new-meta-item category"><a class=notlink><i class="fas fa-folder-open fa-fw" aria-hidden=true></i> <a class=category-link href="/categories/%E5%8D%9A%E5%AE%A2/">博客</a><span class=sep></span><a class=category-link href="/categories/%E5%8D%9A%E5%AE%A2/%E7%BE%8E%E5%9B%A2%E6%8A%80%E6%9C%AF%E5%9B%A2%E9%98%9F/">美团技术团队</a><span class=sep></span><a class=category-link href="/categories/%E5%8D%9A%E5%AE%A2/%E7%BE%8E%E5%9B%A2%E6%8A%80%E6%9C%AF%E5%9B%A2%E9%98%9F/%E6%9C%80%E8%BF%91%E6%9B%B4%E6%96%B0/">最近更新</a></a></div><div class="new-meta-item date"><a class=notlink><i class="fas fa-calendar-alt fa-fw" aria-hidden=true></i><p>发布于：2021年5月27日</p></a></div><div class="new-meta-item browse leancloud"><a class=notlink><div id=lc-pv data-title=外卖套餐搭配的探索和应用 data-path=/p/acac.html><i class="fas fa-eye fa-fw" aria-hidden=true></i><span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 次浏览</div></a></div></div></div><div><h2 id=1-背景>1. 背景</h2><p>让用户更方便快捷地选购到满意的外卖商品，是美团外卖一直在努力的方向。本文主要介绍了针对美食类商家的套餐搭配技术以及应用实践。在外卖点餐的选择过程中，用户一般会考虑单品偏好、组合搭配等因素，挑选商家和商品的过程耗时较长。我们通过套餐搭配技术，基于商家的候选商品，自动搭配优质套餐，轻松解决用户“选择困难症”，能够提升用户的决策效率。</p><h2 id=2-业务目标和挑战>2. 业务目标和挑战</h2><h3 id=2-1-业务目标>2.1 业务目标</h3><p>目前，美团外卖App的套餐搭配应用有很多，有“今日套餐推荐”、“满减神器”、“套餐搭配推荐”等。由于目前外卖商家自行搭配套餐的能力较弱而且意愿不强，导致外卖套餐底层供给对业务场景和商家的覆盖率偏低，不能满足套餐相关推荐排序应用的需求。因此，外卖套餐搭配的业务目标是对于美食类商家搭配出候选的套餐组合，给套餐相关应用方提供更丰富的套餐供给。</p><p><img src=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图1 “套餐推荐” 、“满减神器套餐推荐”、“菜品详情页套餐搭配”应用示例" referrerpolicy=no-referrer></p><p>对于套餐相关应用方，我们进行了业务分析：“今日推荐”、“满减神器”等业务的搭配条件相对较弱且可以离线获取搭配条件，归类为推荐型相关业务，此类业务需要保证商家的套餐覆盖率提升，从而保证商家的推荐露出。详情页、满减加购等业务的搭配条件较强，而且偏实时。例如，详情页是用户指定一个菜品后进行搭配，满减加购场景是用户选择一个菜品和特定的价格区间作为条件。这些属于搭配型业务，此类业务需要保证套餐对实时场景的覆盖，从而保证套餐搭配Tab的露出。套餐搭配算法的目标有：①提升套餐组合的覆盖度，从而给下游的套餐相关应用提供场景覆盖率高、多样性充足的套餐组合。②保证搭配套餐的质量。</p><h3 id=2-2-业务挑战>2.2 业务挑战</h3><p>商品搭配在电商场景下也存在较多的应用，例如淘宝的购物车搭配、服装搭配，化妆品搭配。购物车搭配是基于用户购物车、已购买商品的打包推荐，例如，用户在加购牙刷后，可以给出牙膏的推荐。这类方法主要基于商品的购买行为进行相关性的推荐，目标不是形成一个完成的搭配组合。但是，外卖美食商品搭配则需要考虑整个组合的合理性，而不单纯基于商品是否相关。比如：大量订单中有“小炒肉+番茄鸡蛋汤+米饭”、“鱼香肉丝+番茄鸡蛋汤+米饭”等组合方式，但是“番茄鸡蛋汤+米饭”并不构成一个好的套餐搭配。</p><p>服装搭配和化妆品搭配为面向组合的搭配推荐，对此类搭配问题的解决方案大体分成两类，一类是：搭配模式用于模型挑选商品过程的剪枝，搭配模式可以是人工或者模型的方式先验给出，参考文献中的论文4、5采用此思路，该方法的特点是搭配效果靠剪枝策略+质量评估模型共同保证。另一类是通过端到端的网络参数学习搭配模式思路，论文6和我们的离线套餐搭配采用此思路，该方案的特点是搭配效果更依赖于端到端模型保证，但同时搭配模型更复杂。</p><p>相比电商场景的商品搭配，美食搭配面临独特的业务挑战：</p><ol><li>套餐搭配的业务场景和搭配条件比较多样，因此套餐搭配方案需要满足各类业务、各种搭配条件下的需求。</li><li>美食商品属于非标品，且不同商家销售的商品各不相同，导致套餐搭配模式因商家而异。例如，不同商家销售的宫保鸡丁，在份量、口味、食材、价格上都不相同，因此对于宫保鸡丁这道菜也会有不同的套餐搭配方式。</li><li>算法搭配不可避免会产生低质量的搭配结果，而商品的非标品属性，导致我们更难衡量美食搭配的质量。低质量的搭配可能包括：a.包含不适宜单独销售、非美食品类的搭配，例如包含赠品、锅具、餐具的搭配。b.搭配结果不符合常规搭配模式，例如两份饮料，饮料+馒头等。</li></ol><p>为此，我们的解决方案是：</p><ol><li>为了解决业务场景和搭配条件多样的问题，我们形成了离线、实时结合的算法搭配框架。对于推荐型相关业务，我们采用离线搭配方法预先搭配出套餐候选，再在业务场景中做个性化排序。离线搭配本着规则到模型的迭代思路，规则搭配依赖知识图谱的商品表示，通过高频聚合+规则搭配泛化，产出相对高质量套餐以确保头部商家覆盖。模型搭配可以在保证搭配质量的同时，通过模型泛化提高套餐的场景覆盖率。对于实时搭配型的业务，算法会依据业务的搭配条件实时搭配套餐，进一步提升各个实时场景下的套餐的覆盖率。</li><li>为了解决美食商品非标品的问题，我们引入外卖美食图谱对菜品进行了多方位的刻画。我们基于外卖知识图谱提取了菜品丰富的信息表征，例如菜品的标准菜品、菜品品类、口味、食材、做法等，减弱非标品带来的影响。</li><li>为了保证搭配套餐的质量，我们开发了套餐质量评估的模型。</li></ol><p>总体，我们在非标品的商品表示、商家表示、套餐搭配模型、套餐搭配质量评估上都进行了相关的探索和迭代，形成了如下图2所示的套餐搭配框架。</p><p><img src=https://p0.meituan.net/travelcube/58eafa39313fe6d307ae38f78ec64b6935870.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/58eafa39313fe6d307ae38f78ec64b6935870.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图2 套餐搭配框架" referrerpolicy=no-referrer></p><h2 id=3-套餐搭配模型>3. 套餐搭配模型</h2><h3 id=3-1-基于图谱标签归纳的套餐搭配模型>3.1 基于图谱标签归纳的套餐搭配模型</h3><p>我们面临的一个问题是外卖商品为非标品，菜品数据质量较差、属性缺失。为此，我们基于商家菜单、菜谱、商品描述等多种信息源，通过信息抽取、关系识别、知识融合等多种方法，构建了以美食为核心的知识图谱，对菜品建立了品类、口味、做法、功效等多个维度的表示。</p><p><img src=https://p0.meituan.net/travelcube/629681490ac5f87f05d3eff985be1dde206602.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/629681490ac5f87f05d3eff985be1dde206602.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图3 外卖美食知识图谱" referrerpolicy=no-referrer></p><p>商家的历史高销量套餐一般可认为是优质的套餐，但是，中低销量商家的高销量套餐数量较少，难以支持套餐的个性化推荐等应用。依赖美食图谱对菜品的语义表达，我们首先尝试了基于知识图谱的直接归纳演绎进行套餐搭配的方案。例如，通过高频订单可以归纳得出，&#123;热菜&#125;+&#123;米饭&#125;+&#123;汤&#125;是一个常见的套餐搭配方式，进而对于商家演绎出“番茄炒鸡蛋+番茄鸡蛋汤+米饭”的套餐搭配。</p><p>图谱归纳演绎的过程是高频聚合和基于搭配模板的泛化过程，我们通过订单聚合、同品牌、同标签、同菜品模板泛化，来产生高质量的套餐搭配，同时套餐的商家覆盖率有了显著的提升。但是搭配模板的问题在于较难对搭配质量和泛化程度取得折中。约束性较强的搭配模板可以确保搭配质量，但泛化能力不足，套餐覆盖度较低。如果用单一或少量标签描述搭配项，会导致模式过度泛化，准确率不能保证。为此，我们引入了基于模型的套餐搭配方法。</p><h3 id=3-2-基于encoder-decoder的套餐搭配模型>3.2 基于Encoder-Decoder的套餐搭配模型</h3><p>用户搭配套餐也是一个信息编码到信息输出的过程：用户浏览商家菜单即是编码过程，得到该商家和商品信息的一个整体概况，再基于这个概况去进行套餐的搭配。贴合该过程的一个思路是采用Encoder-Decoder框架进行套餐搭配模型的建设，Encoder类比用户浏览菜单的过程，学习菜单的语义信息，Decoder负责搭配出套餐。Encoder-Decoder是一种深度学习网络框架，已经被广泛应用于文本摘要、机器翻译、对话生成等应用中，其建模的方式是通过编码（特征提取）和解码（目标拟合），学习从Encoder输入数据到Decoder输出数据的映射。常见的编码方式有CNN、RNN、Transformer等结构，解码方式也类似。</p><h4 id=3-2-1-基于lstm的套餐搭配模型>3.2.1 基于LSTM的套餐搭配模型</h4><p>套餐生成问题是要从一个商家的所有候选商品集合中提取出多个商品子集，形成方便用户筛选、可直接下单的套餐。套餐生成的数据源主要是该商家的候选商品信息（如商品的名称、标签、价格、销量等），再结合用餐价格区间、用餐人数等约束条件，以及用户偏好等信息。最初我们采用了LSTM作为Encoder和Decoder的神经网络进行套餐搭配。我们基于图谱语义抽取商品语义表示，并输入Encoder的RNN模型。Encoder编码过程类似于用户翻阅商家候选商品的过程，Encoder端输入菜品名称、菜品标签、菜品的业务属性（价格、销量等），通过LSTM对非标品菜品进行特征抽取。如下图4所示，每个商品的名称经过Embedding层、CNN+Pooling层提取特征，并同菜品标签、类别的Embedding以及价格和销量等连续特征进行拼接，最终作为Encoder RNN中每步的输入。</p><p><img src=https://p0.meituan.net/travelcube/e265ecf94a9c42ec2ea66c176986e3b151818.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/e265ecf94a9c42ec2ea66c176986e3b151818.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图4 Encoder网络结构" referrerpolicy=no-referrer></p><p>Decoder在解码过程中一般依赖一个固定的字典或词典作为候选集，每一步输出候选集中的字、词被选中的概率分布。对于套餐搭配网络来说，Decoder解码的候选集来源于Encoder输入端商家内的商品列表，而非固定维度的外部菜品词表，Pointer Network是建模这一问题的有效架构。Pointer Network是基于Seq2seq的扩展，主要解决的是候选集不固定的问题，这一模型架构已被成功应用于抽取式文本摘要，以及旅行商问题、凸包问题等组合优化问题的解决方案中。</p><p>套餐搭配解码的具体过程为，Decoder每一步预估目标菜品来自菜品列表的概率分布。在第n（n>=1）步时，这个概率分布向量表达了在已经选择了n-1个商品的情况下，某个商品或者终止位被选中的概率。若终止位对应的概率较大，则模型倾向以前n-1个已选商品形成一个完整的套餐搭配。解码过程中，我们结合BeamSearch算法产生TopN个结果，保证搭配的多样性。</p><p><img src=https://p0.meituan.net/travelcube/8c8e4f117edd4479868311e25307ea9c67325.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/8c8e4f117edd4479868311e25307ea9c67325.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图5 Encoder-Decoder网络结构" referrerpolicy=no-referrer></p><h4 id=3-2-2-套餐搭配模型的优化>3.2.2 套餐搭配模型的优化</h4><p><strong>套餐搭配模型的学习目标</strong></p><p>为了解决菜品搭配模式因商家而异的问题，模型通过拟合该商家的历史订单来学习商家的搭配特性。一种较为主流的训练形式是基于商家真实订单，采用Teacher Forcing的形式进行训练，使得模型预测的菜品逐位匹配上真实订单内的菜品。Teacher Forcing式的训练方法使得预测菜品的概率倾向于0-1分布，但是现实的菜品搭配通常是个性化、多样性的，例如在Decoder已经输出“宫保鸡丁”菜品的基础上，下一步选择的主食为“米饭”或者“炒饭”皆可。</p><p>为此，我们对商家历史成单的套餐搭配模式进行统计，计算出商品选择的概率分布，Decoder以此商品选择的概率分布作为训练目标，同预估的分布计算MSE Loss，并最小化该值指导模型的训练。Teacher Forcing的另一个问题是较难引入搭配质量、套餐的点击购买行为等外部知识来指导模型训练，为此我们尝试了采用强化学习的思路进行改进。在解码过程的时刻T，我们通过蒙特卡洛算法采样（Monte Carlo Sampling）出完整的套餐候选，并计算套餐候选的搭配质量分作为Reward，结合MSE Loss和搭配质量分进行模型训练。</p><p><strong>套餐搭配的约束</strong></p><p>套餐搭配过程会面临多种业务约束，例如，对于“满减神器”来说，搭配的套餐需要满足给定的满减价格档位。“智能助手”的套餐搭配过程需要考虑用户选定的筛选条件，例如条件可能为“主食为米饭”且“价格为30元以下”。我们通过剪枝策略保证搭配过程满足约束，以“满减神器”的价格区间约束为例，Decoder端在单步产生候选菜品时，会基于剩余的价格过滤掉超出剩余价格范围的菜品。如下图6所示，对于商家的A、B、C、D、E菜品，Decoder会利用剩余价格的区间“15元以内”对后一轮菜品A、B、C、D、E进行剪枝，并删除超过价格区间的C、D两个菜品。</p><p><img src=https://p0.meituan.net/travelcube/bb4ab8fb48c7fe60750b029be8febfd0133017.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/bb4ab8fb48c7fe60750b029be8febfd0133017.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图6 套餐搭配价格约束" referrerpolicy=no-referrer></p><p><strong>基于Attention网络的套餐搭配模型</strong></p><p>基于LSTM网络的商家内菜品特征提取面临的问题有：第一，商家菜单的菜品本身无序，而RNN网络依赖序列进行建模。第二，菜品之间可能存在长距离的语义依赖，例如，菜单内是否有“米饭”、“馒头”等菜品会影响对于“宫保鸡丁”菜品的搭配。</p><p>为了更好的对无序菜单和菜品之间依赖信息进行表征，我们尝试了基于Attention结构的Encoder-Decoder模型。Encoder部分采用层次化Attention结构提取菜品的语义信息，包含底层单菜品级的Attention和菜品之间的Attention两部分。对于单菜品级的Attention，我们在字维度采用Multi-Head Attention结构得到菜品名称的语义向量，菜品标签同样采用Multi-Head Attention 得到菜品标签语义向量，对于菜品的交易属性，我们采用多层全连接网络提取交易特征的语义向量。</p><p>最后，菜品名称语义向量、菜品标签语义向量、交易特征语义向量拼接后经过全连接层+层归一化得到菜品语义向量。对于菜品之间的Attention层，我们对该店的菜品语义向量列表采用多层Multi-Head Attention得到该店的菜单级别语义向量。模型Decoder部分同样采用Multi-Head Attention进行解码，输入信息包括用户偏好信息、历史时刻的解码输入、价格约束等上下文信息，模型在每步输出商家菜单中的菜品被选择的概率分布。Decoder过程中我们对用户偏好信息同商家菜单级别的语义向量进行Multi-Head Attention，在套餐搭配过程中考虑用户的用餐偏好。</p><p><img src=https://p1.meituan.net/travelcube/5e2370026083da743e6208e336f1505190190.png class=lazyload data-srcset=https://p1.meituan.net/travelcube/5e2370026083da743e6208e336f1505190190.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图7 基于Attention的套餐搭配网络" referrerpolicy=no-referrer></p><h4 id=3-2-3-套餐搭配模型分析>3.2.3 套餐搭配模型分析</h4><p>我们认为商家高质量的搭配可以从订单的销量体现，一种评估方法即是评估模型输出的套餐对商家真实高销量套餐的覆盖。通过离线和在线评估，我们发现该模型可以拟合出商家高销量套餐。在人工评估部分，我们把算法搭配的套餐和真实成单订单进行混合并让人工进行区分，发现人工无法分辨模型搭配的订单和真实成单订单的差异。同时，该模型具备良好的泛化能力，显著提升了套餐对商家和特定业务场景的覆盖度。</p><p>我们对模型输出的菜品表征向量进行了分析，以了解模型的套餐搭配模式。利用TSNE对向量进行降维和聚类，通过聚类图观察发现“主食”、“主菜”、“小食”类的菜品各自聚集在一起，可以看出模型识别了菜品的“主食”、“菜品”、”小食”等品类语义属性，并参考此语义进行套餐搭配。</p><table><thead><tr><th align=center>主食类：”馄饨”的TOP N相似菜品</th><th align=center>菜品类：”红烧肉”的TOP N相似菜品</th></tr></thead><tbody><tr><td align=center>鸡汤大馄饨 0.981</td><td align=center>黄瓜拌牛肉 0.975</td></tr><tr><td align=center>豌杂酸辣粉 0.979</td><td align=center>鲜菇牛肉 0.977</td></tr><tr><td align=center>猪肉馄饨 0.975</td><td align=center>毛家红烧肉 0.980</td></tr><tr><td align=center>清汤牛肉面 0.975</td><td align=center>白菜肥肠 0.973</td></tr><tr><td align=center>皮肚肥肠面 0.974</td><td align=center>拌小肠 0.976</td></tr><tr><td align=center>海鲜炒乌冬面 0.974</td><td align=center>猪头肉 0.981</td></tr><tr><td align=center>大葱肉锅贴 0.973</td><td align=center>红烧小土豆 0.975</td></tr><tr><td align=center>豌杂米粉 0.971</td><td align=center>拌牛肉 0.980</td></tr></tbody></table><h3 id=3-3-实时套餐搭配模型>3.3 实时套餐搭配模型</h3><p>利用离线搭配产生套餐候选的方案可以满足推荐型业务的需求，但对于一些搭配型的业务场景仍然覆盖不足，例如，目前离线套餐对菜品的覆盖度较低，即对于菜品详情页等应用只保证部分PV的搭配模块露出。</p><p>一种解决方案是通过离线搭配提升套餐对美食商品的覆盖，但该方案的存储成本较高，为此我们采用实时套餐搭配方案。实时生成方案的难点在于既要保证套餐质量，又要满足各种搭配条件，最重要的还要保证实时性。最初我们把离线搭配模型应用于线上实时搭配，发现在性能方面存在瓶颈。因此，我们对离线模型进行了精简，精简的思路是将选菜的过程精简为选择菜品类目的过程，将菜品维度的搭配关系精简为菜品类目的搭配关系，实现整个解空间的缩小。如下图8所示，具体流程如下：</p><ol><li><strong>搭配模板挖掘</strong>：通过商家历史订单挖掘出商家高销的类目层面的搭配关系，即搭配模板，例如“热菜+主食”。</li><li><strong>搜索剪枝</strong>：在搭配选菜时，依据搭配模板中的菜品类目，进行菜品的选择。例如上述的例子，首先进行“热菜”的选择，然后进行“主食”的选择。在选择的过程中，根据用户的实时需求，例如指定必选菜、指定价格、指定主食类型等约束条件，对整体的选择过程进行剪枝。</li><li><strong>筛选评估</strong>：在搭配完成后，对得到的候选搭配结果进行质量评估，这里基于性能考虑，使用树模型进行质量评估，筛选出Top N的搭配结果。</li></ol><p><img src=https://p0.meituan.net/travelcube/acc76995ced05506b50009ea872308e4425850.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/acc76995ced05506b50009ea872308e4425850.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图8 实时套餐搭配和离线套餐搭配" referrerpolicy=no-referrer></p><h2 id=4-套餐质量评估>4. 套餐质量评估</h2><p>高销量的订单中也存在搭配质量稍低的套餐，加上模型泛化的精度问题，搭配模型很容易生成质量较差的搭配组合。如下图9右侧，模型生成的后两个套餐搭配相对不是特别合理。为进一步保证用户体验，我们建立了套餐搭配质量模型，对套餐的质量进行统一评估。套餐质量分类模型将套餐搭配质量转化为一个分类问题。因为套餐组合是有多个菜品组成的，所以我们基于菜品名称、标签等信息构造菜品的表示，然后通过Global-Attention来实现菜品间重要程度的考量，同时添加总商品个数、总份数等全局特征来表示整体搭配的信息，模型结构具体见下图9所示：</p><p><img src=https://p0.meituan.net/travelcube/4352519303cc38dfe33e38b9f3303f70912104.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/4352519303cc38dfe33e38b9f3303f70912104.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图9 套餐质量分类" referrerpolicy=no-referrer></p><p>我们对套餐的搭配质量进行了细粒度的分档：极差、差、中、好 ，且四种类别存在有序关系（极差<差<中<好），对应模型有四个输出值，每一个表示该位为1的概率，例如“极差”表示为“1,0,0,0”, “差”表示为“1,1,0,0”，“中”表示为“1,1,1,0”，“好”表示为“1,1,1,1”。模型的损失采用pair hinge loss函数，避免前面节点为0后面节点为1的情况，保证模型的准确度。套餐的搭配质量分值为四个输出节点的求和平均值，使得预测值更加可信。模型结构同一般的分类模型大体一致，目标函数如下：< p><p><img src=https://p0.meituan.net/travelcube/e51f042c32c5ac7109e49a34012f21503011.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/e51f042c32c5ac7109e49a34012f21503011.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图10 套餐质量分类" referrerpolicy=no-referrer></p><p>套餐质量模型的建设过程中，负例样本主要来自用户反馈的Bad Case，和通过人工构造不合理搭配模式版筛出的套餐。这种方式存在的问题是：Bad Case和人工构造的搭配负样本有偏、多样性较差，且负样本同正样本的配比不容易调节。</p><p>为此，我们引入一个预训练任务学习历史订单的搭配模式，为套餐搭配质量模型引入更多的搭配先验知识。预训练过程如下图11所示，我们随机Mask已成单搭配组合中的一个菜品，然后训练Transformer模型还原被Mask掉的菜品。在这个过程中，考虑一些次优套餐的合理性（例如：”宫保鸡丁+米饭+可乐”，Mask掉”宫爆鸡丁”，生成器生成出来的是“鱼香肉丝”，“鱼香肉丝+米饭+可乐”就可理解为一个次优套餐），我们在最后的损失函数添加预测菜品与目标菜品类别相似性的判别器来解决这类情况。预训练得到的参数最终用来初始化套餐搭配质量分档模型，并基于少量的人工标注语料进行模型的调优。</p><p><img src=https://p0.meituan.net/travelcube/c49a51b63896bb1e6dcd8f87ef2bbcd8371917.png class=lazyload data-srcset=https://p0.meituan.net/travelcube/c49a51b63896bb1e6dcd8f87ef2bbcd8371917.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图11 套餐质量分类" referrerpolicy=no-referrer></p><h2 id=5-套餐搭配的应用和未来展望>5. 套餐搭配的应用和未来展望</h2><p>目前，外卖已打造了多款以套餐为核心供给的产品，“今日套餐推荐”帮助用户解决不知道吃什么、选购慢的问题，店铺页内的“满减神器”、“单品搭配推荐”解决用户凑单难、搭配难的问题。为了解决了各业务场景下套餐搭配难题，套餐搭配算法针对覆盖度、搭配质量、搭配多样性进行了持续优化，为业务提供了重要的技术和数据支撑。离线套餐搭配用于”满减神器“、”今日套餐推荐“等业务，显著提高了套餐商家的覆盖率，实时套餐搭配用于“菜品详情页套餐搭配”等业务，并取得较好的业务收益。</p><p>后续工作，一方面我们会继续优化菜品知识图谱的构建，完善对非标品菜品的刻画，通过引入图像等多模态数据进一步提升数据准确度和覆盖度，通过构建场景知识图谱更好地刻画用户需求和供给。另一方面我们会探索场景化的套餐搭配：目前我们在场景化套餐搭配方面的工作较少，而且用户在不同场景下会有不同的套餐需求，例如天气寒冷偏爱吃火锅类套餐、腊八节吃粥类套餐，在异地希望吃当地特色类套餐。接下来，我们会在场景化套餐搭配方面进行探索，针对节气、节日、人群等场景搭配套餐，更好的满足用户个性化、场景化的用餐需求。</p><p><img src=https://p1.meituan.net/travelcube/a8263b535e4b712d22e905b7ac9f91971739659.png class=lazyload data-srcset=https://p1.meituan.net/travelcube/a8263b535e4b712d22e905b7ac9f91971739659.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图12 套餐搭配相关应用" referrerpolicy=no-referrer></p><h2 id=6-参考文献>6. 参考文献</h2><ol><li>Vinyals, Oriol, Meire Fortunato, and Navdeep Jaitly. “Pointer networks.” Advances in neural information processing systems. 2015.</li><li>See, Abigail, Peter J. Liu, and Christopher D. Manning. “Get to the point: Summarization with pointer-generator networks.” arXiv preprint arXiv:1704.04368 (2017).</li><li>Gong, Jingjing, et al. “End-to-end neural sentence ordering using pointer network.” arXiv preprint arXiv:1611.04953 (2016).</li><li>Han, Xintong, et al. “Learning fashion compatibility with bidirectional lstms.” Proceedings of the 25th ACM international conference on Multimedia. 2017.</li><li>Alashkar, Taleb, et al. “Examples-Rules Guided Deep Neural Network for Makeup Recommendation.” AAAI. 2017.</li><li>Chen, Wen, et al. “Pog: Personalized outfit generation for fashion recommendation at alibaba ifashion.” Proceedings of the 25th ACM SIGKDD International Conference on Knowledge Discovery & Data Mining. 2019.</li><li>Rush, Alexander M., Sumit Chopra, and Jason Weston. “A neural attention model for abstractive sentence summarization.” arXiv preprint arXiv:1509.00685 (2015).</li><li>Paulus, Romain, Caiming Xiong, and Richard Socher. “A deep reinforced model for abstractive summarization.” arXiv preprint arXiv:1705.04304 (2017).</li><li>See, Abigail, Peter J. Liu, and Christopher D. Manning. “Get to the point: Summarization with pointer-generator networks.” arXiv preprint arXiv:1704.04368 (2017).</li></ol><h2 id=7-作者简介>7. 作者简介</h2><p>瑞玉、文斌、杨林、懋地，均来自美团外卖技术团队。</p></差<中<好），对应模型有四个输出值，每一个表示该位为1的概率，例如“极差”表示为“1,0,0,0”,></p></div><div class=footer><div class=copyright><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href=https://news.slqwq.cn/p/acac.html>https://news.slqwq.cn/p/acac.html</a></p></blockquote></div></div><div class=article-meta id=bottom><div class=new-meta-box><div class="new-meta-item date" itemprop=dateUpdated datetime=2021-07-11T00:43:41+00:00><a class=notlink><i class="fas fa-edit fa-fw" aria-hidden=true></i><p>更新于：2021年7月11日</p></a></div><div class="new-meta-item share -mob-share-list"><div class="-mob-share-list share-body"><a class=-mob-share-qq rel="external nofollow noopener noreferrer noopener" target=_blank href="http://connect.qq.com/widget/shareqq/index.html?url=https://news.slqwq.cn/p/acac.html&title=外卖套餐搭配的探索和应用 - Hajeekn RSSHUB&pics=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class=-mob-share-qzone rel="external nofollow noopener noreferrer noopener" target=_blank href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://news.slqwq.cn/p/acac.html&title=外卖套餐搭配的探索和应用 - Hajeekn RSSHUB&pics=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a> <a class=-mob-share-weibo rel="external nofollow noopener noreferrer noopener" target=_blank href="http://service.weibo.com/share/share.php?url=https://news.slqwq.cn/p/acac.html&title=外卖套餐搭配的探索和应用 - Hajeekn RSSHUB&pics=https://p0.meituan.net/travelcube/3e87032a7441aaced43b89eb0408074f1245404.png&summary="><img src=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png class=lazyload data-srcset=https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a></div></div></div></div><div class=prev-next><a class=prev href=/p/6821.html><p class=title><i class="fas fa-chevron-left" aria-hidden=true></i>外卖商品的标准化建设与应用</p><p class=content>1. 背景及目标商品作为外卖交易过程中的核心要素，决定了供需匹配的精准度，直接影响交易行为是否可以达成。外卖平台美食、甜点、饮品类在线商品有亿级之多，其中很多是属性信息一致的相同商品。建...</p></a><a class=next href=/p/c89c.html><p class=title>虚幻5降临！再谈谈它的_黑科技_<i class="fas fa-chevron-right" aria-hidden=true></i></p><p class=content>2020年5月13日，知名游戏引擎公司Epic发布了一条令无数影视从业者、游戏从业者甚至玩家都激动不已的视频 ——《初探虚幻引擎5》，视频通过逼真的场景和代入感超强的实时动画将一款次时...</p></a></div></article></div><aside class=l_side><section class="widget toc-wrapper shadow desktop mobile" id=toc-div><header><i class="fas fa-list fa-fw" aria-hidden=true></i> <span class=name>本文目录</span></header><div class=content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#1-%E8%83%8C%E6%99%AF><span class=toc-text>1. 背景</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#2-%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87%E5%92%8C%E6%8C%91%E6%88%98><span class=toc-text>2. 业务目标和挑战</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#2-1-%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87><span class=toc-text>2.1 业务目标</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-2-%E4%B8%9A%E5%8A%A1%E6%8C%91%E6%88%98><span class=toc-text>2.2 业务挑战</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#3-%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B><span class=toc-text>3. 套餐搭配模型</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#3-1-%E5%9F%BA%E4%BA%8E%E5%9B%BE%E8%B0%B1%E6%A0%87%E7%AD%BE%E5%BD%92%E7%BA%B3%E7%9A%84%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B><span class=toc-text>3.1 基于图谱标签归纳的套餐搭配模型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-2-%E5%9F%BA%E4%BA%8Eencoder-decoder%E7%9A%84%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B><span class=toc-text>3.2 基于Encoder-Decoder的套餐搭配模型</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#3-2-1-%E5%9F%BA%E4%BA%8Elstm%E7%9A%84%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B><span class=toc-text>3.2.1 基于LSTM的套餐搭配模型</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#3-2-2-%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BC%98%E5%8C%96><span class=toc-text>3.2.2 套餐搭配模型的优化</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#3-2-3-%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B%E5%88%86%E6%9E%90><span class=toc-text>3.2.3 套餐搭配模型分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-3-%E5%AE%9E%E6%97%B6%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E6%A8%A1%E5%9E%8B><span class=toc-text>3.3 实时套餐搭配模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#4-%E5%A5%97%E9%A4%90%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0><span class=toc-text>4. 套餐质量评估</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#5-%E5%A5%97%E9%A4%90%E6%90%AD%E9%85%8D%E7%9A%84%E5%BA%94%E7%94%A8%E5%92%8C%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B><span class=toc-text>5. 套餐搭配的应用和未来展望</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#6-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE><span class=toc-text>6. 参考文献</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#7-%E4%BD%9C%E8%80%85%E7%AE%80%E4%BB%8B><span class=toc-text>7. 作者简介</span></a></li></ol></div></section></aside><script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="外卖套餐搭配的探索和应用";
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  // header 这里无论是否开启pjax都需要
  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
  
    // cover
    var cover_wrapper=document.querySelector('.cover-wrapper');
    
    cover_wrapper.id="none";
    cover_wrapper.style.display="none";
    
  
</script></div><footer class="footer clearfix"><br><br><div class=aplayer-container></div><br><div class=social-wrapper></div><div><p>博客内容遵循 <a target=_blank rel=noopener href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p></div><div><p><span id=lc-sv>本站总访问量为<span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 次</span> <span id=lc-uv>访客数为<span id=number><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden=true></i></span> 人</span></p></div>本站使用 <a href=https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1 target=_blank class=codename>Volantis</a> 作为主题<div class=copyright><p><a href="/">Copyright © 2017-2020 XXX</a></p></div></footer><a id=s-top class="fas fa-arrow-up fa-fw" href=javascript:void(0)></a></div></div><div><script>
/************这个文件存放不需要重载的全局变量和全局函数*********/
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/******************** Pjax ********************************/
function VPjax(){
	this.list=[] // 存放回调函数
	this.start=()=>{
	  for(var i=0;i<this.list.length;i++){
		this.list[i].run();
	  }
	}
	this.push=(fn,name)=>{
		var f=new PjaxItem(fn,name);
		this.list.push(f);
	}
	// 构造一个可以run的对象
	function PjaxItem(fn,name){
		// 函数名称
		this.name = name || fn.name
		// run方法
		this.run=()=>{
			fn()
		}
	}
}
volantis.pjax={}
volantis.pjax.method={
	complete: new VPjax(),
	error: new VPjax(),
	send: new VPjax()
}
volantis.pjax={
	...volantis.pjax,
	push: volantis.pjax.method.complete.push,
	error: volantis.pjax.method.error.push,
	send: volantis.pjax.method.send.push
}
/********************脚本懒加载函数********************************/
// 已经加入了setTimeout
function loadScript(src, cb) {
	setTimeout(function() {
		var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
		var script = document.createElement('script');
		script.setAttribute('type','text/javascript');
		if (cb) script.onload = cb;
		script.setAttribute('src', src);
		HEAD.appendChild(script);
	});
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script><script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js></script><script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };
  $(function () {
    SCload_fancybox();
  });
  function Pjax_SCload_fancybox(){
	if (typeof $.fancybox == "undefined") {
	 SCload_fancybox();
    } else {
	 pjax_fancybox();
    }
  }
  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
  },'fancybox')
</script><script>
  function loadIssuesJS() {
    if ($(".md").find(".issues-api").length == 0) return;
	
	  loadScript('/js/issues.js');
	
  };
  $(function () {
    loadIssuesJS();
  });
  volantis.pjax.push(()=>{
	if (typeof IssuesAPI == "undefined") {
	  loadIssuesJS();
	}
  },"IssuesJS")
</script><script defer src=https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js></script><script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script><script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: [],
	maxRPS: 5,
	hoverDelay: 25
  };
</script><script defer src=https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js></script><script src=/js/valine.js></script><script>
  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;
    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~";
    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }
    var valine = new Valine();
    valine.init(Object.assign({"path":null,"placeholder":"快来评论吧~","appId":null,"appKey":null,"meta":["nick","mail","link"],"requiredFields":["nick","mail"],"enableQQ":true,"recordIP":false,"avatar":"robohash","pageSize":10,"lang":"zh-cn","highlight":true,"mathJax":false}, {
      el: '#valine_container',
      path: path,
      placeholder: pagePlaceholder,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps,
    }))
  }
  $(function () {
    pjax_valine();
  });
  volantis.pjax.push(pjax_valine);
</script><script src=/js/app.js></script><script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('/js/search/hexo.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
}
</script><script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://news.slqwq.cn' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://news.slqwq.cn' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://news.slqwq.cn' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script><script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
    localStorage.setItem(k, v);
};

const removeLS = (k) => {
    localStorage.removeItem(k);
};

const getLS = (k) => {
    return localStorage.getItem(k);
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
var btn=$("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn");
function bindToggleButton() {
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
volantis.pjax.push(bindToggleButton);
volantis.pjax.send(()=>{
	btn.unbind('click');
},'toggle-mode-btn-unbind');
</script><script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script><script src=https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js></script><script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）

      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
		// 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
		volantis.pjax.method.complete.start();
      } catch (e) {
        console.log(e);
      }
    });

    document.addEventListener('pjax:error', function (e) {
	  // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.error.start();
      window.location.href = e.triggerElement.href;
    });
</script></div></body></html>